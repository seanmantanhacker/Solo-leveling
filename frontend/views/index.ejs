<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Mini 2D Adventure</title>
    <style>
        body { margin: 0; background: #000; }
        canvas { display: block; margin: auto; }
    </style>
</head>
<body>

<script src="/socket.io/socket.io.js"></script>
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
<script type="module" src="/basic.js"></script>

</body>
</html>

<script>
const socket = io();

socket.on('currentPlayers', players => {
    Object.keys(players).forEach(id => {
        if(id !== socket.id){
            addOtherPlayer(players[id], id);
        }
    });
});

socket.on('newPlayer', playerInfo => {
    addOtherPlayer(playerInfo, playerInfo.id);
});

socket.on('playerMoved', playerInfo => {
    if(otherPlayers[playerInfo.id]){
        otherPlayers[playerInfo.id].x = playerInfo.x;
        otherPlayers[playerInfo.id].y = playerInfo.y;
    }
});

socket.on('playerDisconnected', id => {
    if(otherPlayers[id]){
        otherPlayers[id].destroy();
        delete otherPlayers[id];
    }
});

function addOtherPlayer(info, id){
    console.log("Tes")
    // let other = this.physics.add.sprite(info.x, info.y, 'dude');
    console.log("Tes2")
    enemy = new Character(this, info.x, info.y, 'dude', cursors, wasdKeys);
    console.log("Tes3")
    otherPlayers[id] = other;
}

// In your Phaser update loop
// socket.emit('playerMovement', { x: player.x, y: player.y });
</script>

<script type="module">
    import {cursors, wasdKeys } from '/basic.js';
    import Character from '/Character.js';
    // Spawn a new character at a random position
    const x = Math.random() * 800;
    const y = Math.random() * 600;
    const scene = game.scene.scenes[0]; // get the active Phaser scene
    const npc = new Character(scene, x, y, 'dude', cursors, wasdKeys);
        
    
</script>